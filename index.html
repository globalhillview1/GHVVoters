<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8" />
Â  <title>Voters</title>
Â  <meta name="viewport" content="width=device-width, initial-scale=1" />
Â  <style>
Â  Â  /* CSS Styling */
Â  Â  :root{
Â  Â  Â  --bg:#f7f9fc; --card:#fff; --text:#0f172a; --muted:#64748b; --border:#e5e7eb; --hover:#f1f5f9;
Â  Â  Â  --blue:#0d6efd; --danger:#ef4444; --radius:10px;
Â  Â  }
Â  Â  *{box-sizing:border-box}
Â  Â  body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial}

Â  Â  /* Header & Layout */
Â  Â  header{position:sticky;top:0;z-index:10;display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 16px;background:var(--card);border-bottom:1px solid var(--border); box-shadow: 0 1px 3px rgba(0,0,0,0.05);}
Â  Â  .brand{display:flex;align-items:center;gap:10px}
Â  Â  .brand img{height:28px;width:28px;border-radius:6px;object-fit:cover}
Â  Â  h1{margin:0;font-weight:800;font-size:20px}
Â  Â  .wrap{padding:16px}
Â  Â  .card{background:#fff;border:1px solid var(--border);border-radius:var(--radius);padding:16px}
Â  Â  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
Â  Â  .muted{color:var(--muted)}
Â  Â  .hidden{display:none}

Â  Â  /* Form Elements */
Â  Â  input,select,textarea{border:1px solid var(--border);border-radius:8px;padding:8px 10px;font:inherit;outline:none;}
Â  Â  input:focus, select:focus, textarea:focus {border-color: var(--blue); box-shadow: 0 0 0 2px rgba(13, 110, 253, 0.25);}
Â  Â  .btn{appearance:none;border:none;background:var(--hover);padding:10px 14px;border-radius:8px;cursor:pointer;transition:background 0.1s; font-weight: 500;}
Â  Â  .btn:hover{background:var(--border)}
Â  Â  .btn.primary{background:var(--blue);color:#fff;border-color:transparent}
Â  Â  .btn.primary:hover{background:#0b5ed7}
Â  Â  .btn.danger{background:var(--danger);color:#fff;border-color:transparent}
Â  Â  .btn.danger:hover{background:#dc3545}
Â  Â  
Â  Â  /* Breadcrumb */
Â  Â  .breadcrumb{display:flex;flex-wrap:wrap;gap:6px;align-items:center;
Â  Â  Â  padding:8px 16px 0;color:#6b7280;font-size:14px;}
Â  Â  .breadcrumb a{color:inherit;text-decoration:none}
Â  Â  .breadcrumb a:hover{text-decoration:underline}
Â  Â  .breadcrumb .sep{opacity:.6}

Â  Â  /* Table Styling */
Â  Â  .tableWrap{overflow:auto;max-height:calc(100vh - 200px); background:#fff; border-radius: var(--radius);}
Â  Â  table{width:100%;border-collapse:separate;border-spacing:0;table-layout:fixed; min-width: 1200px;}
Â  Â  thead th{position:sticky;top:0;background:var(--card);border-bottom:1px solid var(--border);padding:12px 10px;text-align:left;white-space:nowrap;z-index:1; font-weight: 600; color: var(--muted);}
Â  Â  tbody tr:hover {background: var(--hover);}
Â  Â  tbody td{border-top:1px solid var(--border);padding:10px;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap; max-width: 250px;}
Â  Â  
Â  Â  /* Sort Icons */
Â  Â  th.sort{cursor:pointer;user-select:none; position: relative; padding-right: 25px;}
Â  Â  th.sort:after{content:"\21C5";color:#94a3b8;font-weight:400; position: absolute; right: 8px; top: 12px; font-size: 14px;}
Â  Â  th.sort.asc:after{content:"\2191"; color: var(--blue);} 
Â  Â  th.sort.desc:after{content:"\2193"; color: var(--blue);}
Â  Â  th:not(.sort):after { content: '';} /* Ensure non-sortable headers don't have an icon */


Â  Â  /* Modal */
Â  Â  .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:50;align-items:center;justify-content:center;padding:10px;}
Â  Â  .modal .box{background:#fff;border-radius:12px;border:1px solid var(--border);padding:24px;width:min(900px,95vw); box-shadow: 0 10px 20px rgba(0,0,0,0.1);}
Â  Â  .box h3{margin:0 0 16px; font-size: 24px; font-weight: 700;}
Â  Â  .modal label {display: block; margin-bottom: 15px; font-weight: 500;}
Â  Â  .modal label input, .modal label select {margin-top: 4px; display: block; width: 100%;}
Â  Â  .modal-fields {display: flex; flex-wrap: wrap; gap: 20px;}
Â  Â  .modal-fields > label {flex: 1 1 200px;}
Â  Â  .modal-fields > label.full-width {flex: 1 1 100%;}
Â  Â  
Â  Â  /* Responsive Adjustments */
Â  Â  @media (max-width: 600px) {
Â  Â  Â  header {flex-direction: column; align-items: flex-start;}
Â  Â  Â  .header-actions {width: 100%; justify-content: space-between;}
Â  Â  Â  .wrap {padding: 8px;}
Â  Â  Â  .card {padding: 12px;}
Â  Â  Â  .row {gap: 8px;}
Â  Â  Â  .modal-fields > label {flex: 1 1 100%; margin-bottom: 10px;}
Â  Â  }
Â  </style>
</head>
<body>
Â  
Â  <header>
Â  Â  <div class="brand">
Â  Â  Â  <!-- Icon Placeholder -->
Â  Â  Â  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
Â  Â  Â  Â  <path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM6.09 17.52C7.38 16.32 9.5 15.5 12 15.5C14.5 15.5 16.62 16.32 17.91 17.52C16.5 18.87 14.33 19.75 12 19.75C9.67 19.75 7.5 18.87 6.09 17.52ZM12 14C13.66 14 15 12.66 15 11C15 9.34 13.66 8 12 8C10.34 8 9 9.34 9 11C9 12.66 10.34 14 12 14ZM19.93 15.82C18.45 14.07 15.64 13.25 12 13.25C8.36 13.25 5.55 14.07 4.07 15.82C3.19 14.61 2.75 13.34 2.75 12C2.75 6.84 6.84 2.75 12 2.75C17.16 2.75 21.25 6.84 21.25 12C21.25 13.34 20.81 14.61 19.93 15.82Z" fill="#0d6efd"/>
Â  Â  Â  </svg>
Â  Â  Â  <h1>Voters</h1>
Â  Â  </div>
Â  Â  <div class="row header-actions">
Â  Â  Â  <span class="muted" id="userBadge">@demo</span>
Â  Â  Â  <button class="btn" onclick="location.href='.'">Back to Dashboard</button>
Â  Â  Â  <button class="btn danger" onclick="logout()">Logout</button>
Â  Â  </div>
Â  </header>

Â  <nav class="breadcrumb">
Â  Â  <a href=".">Home</a> <span class="sep">/</span> <span>Voters</span>
Â  </nav>

Â  <div class="wrap">
Â  Â  <div class="card">
Â  Â  Â  <div class="row" style="justify-content:space-between; margin-bottom: 12px;">
Â  Â  Â  Â  <div class="row">
Â  Â  Â  Â  Â  <input id="q" placeholder="Quick search..." style="min-width:280px">
Â  Â  Â  Â  Â  <span id="meta" class="muted">Timezone: IST</span>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="row">
Â  Â  Â  Â  Â  <button id="addBtn" class="btn primary">+ Add Voter</button>
Â  Â  Â  Â  Â  <span id="status" class="muted"></span>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <div class="tableWrap">
Â  Â  Â  Â  <table id="grid">
Â  Â  Â  Â  Â  <colgroup>
Â  Â  Â  Â  Â  Â  <col style="width:70px"> <!-- Serial # -->
Â  Â  Â  Â  Â  Â  <col style="width:90px"> <!-- Tower No. -->
Â  Â  Â  Â  Â  Â  <col style="width:90px"> <!-- Flat No. -->
Â  Â  Â  Â  Â  Â  <col style="width:200px"> <!-- First Owner Name -->
Â  Â  Â  Â  Â  Â  <col style="width:200px"> <!-- Second Owner Name -->
Â  Â  Â  Â  Â  Â  <col style="width:120px"> <!-- Card & Share # -->
Â  Â  Â  Â  Â  Â  <col style="width:120px"> <!-- Eligible Voter -->
Â  Â  Â  Â  Â  Â  <col style="width:180px"> <!-- Discrepancy -->
Â  Â  Â  Â  Â  Â  <col style="width:120px"> <!-- Voted Earlier -->
Â  Â  Â  Â  Â  Â  <col style="width:150px"> <!-- Actions -->
Â  Â  Â  Â  Â  </colgroup>
Â  Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  <th class="sort" data-k="serial">Serial #</th>
Â  Â  Â  Â  Â  Â  Â  <th class="sort" data-k="tower">Tower No.</th>
Â  Â  Â  Â  Â  Â  Â  <th class="sort" data-k="flat">Flat No.</th>
Â  Â  Â  Â  Â  Â  Â  <th class="sort" data-k="firstOwner">First Owner Name</th>
Â  Â  Â  Â  Â  Â  Â  <th class="sort" data-k="secondOwner">Second Owner Name</th>
Â  Â  Â  Â  Â  Â  Â  <th class="sort" data-k="cardShare">Card &amp; Share #</th>
Â  Â  Â  Â  Â  Â  Â  <th class="sort" data-k="eligible">Eligible Voter</th>
Â  Â  Â  Â  Â  Â  Â  <th class="sort" data-k="discrepancy">Discrepancy</th>
Â  Â  Â  Â  Â  Â  Â  <th class="sort" data-k="votedEarlier">Voted Earlier</th>
Â  Â  Â  Â  Â  Â  Â  <th>Actions</th>
Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  <tbody id="body">
Â  Â  Â  Â  Â  Â  <!-- Data rows will be injected here -->
Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  </table>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  <!-- Add/Edit Modal -->
Â  <div id="modal" class="modal">
Â  Â  <div class="box">
Â  Â  Â  <h3 id="m_title">Add Voter</h3>
Â  Â  Â  <input id="m_serial" type="hidden">
Â  Â  Â  <div class="modal-fields">
Â  Â  Â  Â  <label>Tower No. <input id="m_tower" required></label>
Â  Â  Â  Â  <label>Flat No. <input id="m_flat" required></label>
Â  Â  Â  Â  <label>Card &amp; Share # <input id="m_cardshare" type="number" step="1" min="0" placeholder="(Optional)"></label>
Â  Â  Â  Â  
Â  Â  Â  Â  <label class="full-width">First Owner Name <input id="m_first" required></label>
Â  Â  Â  Â  <label class="full-width">Second Owner Name <input id="m_second" placeholder="(Optional)"></label>
Â  Â  Â  Â  
Â  Â  Â  Â  <label>Eligible Voter
Â  Â  Â  Â  Â  <select id="m_eligible">
Â  Â  Â  Â  Â  Â  <option>Yes</option>
Â  Â  Â  Â  Â  Â  <option>No</option>
Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  </label>
Â  Â  Â  Â  <label>Voted Earlier
Â  Â  Â  Â  Â  <select id="m_voted">
Â  Â  Â  Â  Â  Â  <option>Yes</option>
Â  Â  Â  Â  Â  Â  <option>No</option>
Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  </label>
Â  Â  Â  Â  <label class="full-width">Discrepancy
Â  Â  Â  Â  Â  <input id="m_discrepancy" placeholder="(Optional)">
Â  Â  Â  Â  </label>
Â  Â  Â  </div>
Â  Â  Â  <div class="row" style="margin-top:20px; justify-content: flex-end;">
Â  Â  Â  Â  <span id="m_status" class="muted"></span>
Â  Â  Â  Â  <button class="btn" onclick="closeModal()">Cancel</button>
Â  Â  Â  Â  <button id="m_save" class="btn primary">Save Voter</button>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  <script>
Â  Â  /* ====== Config / helpers ====== */
Â  Â  // ðŸš¨ IMPORTANT: Replace this placeholder with your actual deployed Apps Script URL
Â  Â  const API = '/api'; 

Â  Â  // Basic helper functions
Â  Â  const esc = s => String(s??'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
Â  Â  const logout = () => { console.log("Logging out (simulated)"); location.href='.'; }; // Simple redirect for this demo

Â  Â  let all=[], rows=[], sortKey='serial', sortDir='asc';

Â  Â  /* ====== API Calls (No Authentication) ====== */
Â  Â  
Â  Â  async function fetchVoters(){
Â  Â  Â  try {
Â  Â  Â  Â  const r=await fetch(`${API}?action=voters`,{cache:'no-store'});
Â  Â  Â  Â  const j=await r.json(); 
Â  Â  Â  Â  if(!j.ok) throw new Error(j.error||'Failed to fetch data'); 
Â  Â  Â  Â  return j.data||[];
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  console.error("Fetch error:", error);
Â  Â  Â  Â  document.getElementById('status').textContent = 'API Error: ' + error.message;
Â  Â  Â  Â  return [];
Â  Â  Â  }
Â  Â  }

Â  Â  async function apiPost(action, payload) {
Â  Â  Â  const r=await fetch(`${API}?action=${action}`,{
Â  Â  Â  Â  method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)
Â  Â  Â  });
Â  Â  Â  const j=await r.json(); 
Â  Â  Â  if(!j.ok) throw new Error(j.error||'Operation failed'); 
Â  Â  Â  return j.data;
Â  Â  }

Â  Â  async function addVoter(payload){ return apiPost('addvoter', payload); }
Â  Â  async function updateVoter(payload){ return apiPost('updatevoter', payload); }
Â  Â  async function deleteVoter(serial){ return apiPost('deletevoter', {serial}); }

Â  Â  /* ====== Rendering and Filtering ====== */
Â  Â  function apply(){
Â  Â  Â  const q=(document.getElementById('q').value||'').toLowerCase();
Â  Â  Â  rows = (all||[]).filter(r=>{
Â  Â  Â  Â  // Create a searchable string from all relevant fields
Â  Â  Â  Â  const hay = `${r.serial} ${r.tower} ${r.flat} ${r.firstOwner} ${r.secondOwner} ${r.cardShare} ${r.eligible} ${r.discrepancy||''} ${r.votedEarlier}`.toLowerCase();
Â  Â  Â  Â  return !q || hay.includes(q);
Â  Â  Â  }).sort((a,b)=>{
Â  Â  Â  Â  let A=a[sortKey], B=b[sortKey];
Â  Â  Â  Â  
Â  Â  Â  Â  // Convert to number for specific keys for correct sorting
Â  Â  Â  Â  if(sortKey==='serial' || sortKey==='cardShare'){
Â  Â  Â  Â  Â  A=Number(A||0); B=Number(B||0);
Â  Â  Â  Â  }else if(sortKey==='flat'){
Â  Â  Â  Â  Â  const na=parseInt(A,10), nb=parseInt(B,10);
Â  Â  Â  Â  Â  // If both are valid numbers, sort numerically, otherwise string comparison
Â  Â  Â  Â  Â  if(!isNaN(na) && !isNaN(nb)){ A=na; B=nb; } else { A=(A??'').toString().toLowerCase(); B=(B??'').toString().toLowerCase(); }
Â  Â  Â  Â  }else{
Â  Â  Â  Â  Â  A=(A??'').toString().toLowerCase(); B=(B??'').toString().toLowerCase();
Â  Â  Â  Â  }

Â  Â  Â  Â  const s=(A<B?-1:A>B?1:0);
Â  Â  Â  Â  return sortDir==='asc'?s:-s;
Â  Â  Â  });
Â  Â  Â  render();
Â  Â  }

Â  Â  function render(){
Â  Â  Â  const tb=document.getElementById('body'); 
Â  Â  Â  tb.innerHTML='';
Â  Â  Â  
Â  Â  Â  rows.forEach(r=>{
Â  Â  Â  Â  const tr=document.createElement('tr');
Â  Â  Â  Â  tr.innerHTML=`
Â  Â  Â  Â  Â  <td>${esc(r.serial)}</td>
Â  Â  Â  Â  Â  <td>${esc(r.tower)}</td>
Â  Â  Â  Â  Â  <td>${esc(r.flat)}</td>
Â  Â  Â  Â  Â  <td title="${esc(r.firstOwner)}">${esc(r.firstOwner)}</td>
Â  Â  Â  Â  Â  <td title="${esc(r.secondOwner||'')}">${esc(r.secondOwner||'')}</td>
Â  Â  Â  Â  Â  <td>${r.cardShare != null && r.cardShare !== '' ? esc(r.cardShare) : ''}</td>
Â  Â  Â  Â  Â  <td>${esc(r.eligible)}</td>
Â  Â  Â  Â  Â  <td title="${esc(r.discrepancy||'')}">${esc(r.discrepancy||'')}</td>
Â  Â  Â  Â  Â  <td>${esc(r.votedEarlier)}</td>
Â  Â  Â  Â  Â  <td class="td-actions">
Â  Â  Â  Â  Â  Â  <button class="btn" onclick="openModal(true, ${r.serial})">Edit</button>
Â  Â  Â  Â  Â  Â  <button class="btn danger" onclick="onDelete(${r.serial})">Delete</button>
Â  Â  Â  Â  Â  </td>`;
Â  Â  Â  Â  tb.appendChild(tr);
Â  Â  Â  });
Â  Â  Â  document.getElementById('status').textContent = `${rows.length} voter(s)`;
Â  Â  }

Â  Â  /* ====== Modal Logic ====== */
Â  Â  function openModal(edit=false, serial=null){
Â  Â  Â  document.getElementById('m_status').textContent='';
Â  Â  Â  document.getElementById('m_title').textContent = edit?'Edit Voter':'Add Voter';
Â  Â  Â  
Â  Â  Â  // Reset form inputs
Â  Â  Â  document.getElementById('m_serial').value='';
Â  Â  Â  ['m_tower','m_flat','m_first','m_second','m_cardshare','m_discrepancy'].forEach(id=>document.getElementById(id).value='');
Â  Â  Â  document.getElementById('m_eligible').value='Yes';
Â  Â  Â  document.getElementById('m_voted').value='No';
Â  Â  Â  
Â  Â  Â  if(edit){
Â  Â  Â  Â  const r=all.find(x=>x.serial==serial);
Â  Â  Â  Â  if (r) {
Â  Â  Â  Â  Â  document.getElementById('m_serial').value=r.serial;
Â  Â  Â  Â  Â  document.getElementById('m_tower').value=r.tower||'';
Â  Â  Â  Â  Â  document.getElementById('m_flat').value=r.flat||'';
Â  Â  Â  Â  Â  document.getElementById('m_first').value=r.firstOwner||'';
Â  Â  Â  Â  Â  document.getElementById('m_second').value=r.secondOwner||'';
Â  Â  Â  Â  Â  document.getElementById('m_cardshare').value=r.cardShare||'';
Â  Â  Â  Â  Â  document.getElementById('m_eligible').value=r.eligible||'Yes';
Â  Â  Â  Â  Â  document.getElementById('m_discrepancy').value=r.discrepancy||'';
Â  Â  Â  Â  Â  document.getElementById('m_voted').value=r.votedEarlier||'No';
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  document.getElementById('modal').style.display='flex';
Â  Â  }
Â  Â  
Â  Â  function closeModal(){ 
Â  Â  Â  document.getElementById('modal').style.display='none'; 
Â  Â  }

Â  Â  async function onSave(){
Â  Â  Â  const s=document.getElementById('m_status');
Â  Â  Â  const cardShareValue = document.getElementById('m_cardshare').value;
Â  Â  Â  
Â  Â  Â  const payload={
Â  Â  Â  Â  serial: document.getElementById('m_serial').value || undefined,
Â  Â  Â  Â  tower: (document.getElementById('m_tower').value||'').trim(),
Â  Â  Â  Â  flat: (document.getElementById('m_flat').value||'').trim(),
Â  Â  Â  Â  firstOwner: (document.getElementById('m_first').value||'').trim(),
Â  Â  Â  Â  secondOwner: (document.getElementById('m_second').value||'').trim(),
Â  Â  Â  Â  cardShare: cardShareValue === '' ? '' : Number(cardShareValue),
Â  Â  Â  Â  eligible: document.getElementById('m_eligible').value,
Â  Â  Â  Â  discrepancy: (document.getElementById('m_discrepancy').value||'').trim(),
Â  Â  Â  Â  votedEarlier: document.getElementById('m_voted').value
Â  Â  Â  };

Â  Â  Â  if(!payload.tower || !payload.flat || !payload.firstOwner){
Â  Â  Â  Â  s.textContent='Tower, Flat, and First Owner are required.'; return;
Â  Â  Â  }

Â  Â  Â  s.textContent='Saving...';
Â  Â  Â  try{
Â  Â  Â  Â  if(payload.serial){ await updateVoter(payload); }
Â  Â  Â  Â  else { await addVoter(payload); }
Â  Â  Â  Â  
Â  Â  Â  Â  s.textContent='Saved'; 
Â  Â  Â  Â  closeModal(); 
Â  Â  Â  Â  await reload();
Â  Â  Â  }catch(e){ 
Â  Â  Â  Â  s.textContent='Save failed: '+e.message; 
Â  Â  Â  }
Â  Â  }

Â  Â  async function onDelete(serial){
Â  Â  Â  if(!window.confirm('Are you sure you want to delete voter #' + serial + '?')) return;
Â  Â  Â  try{ 
Â  Â  Â  Â  await deleteVoter(serial); 
Â  Â  Â  Â  await reload(); 
Â  Â  Â  } catch(e){ 
Â  Â  Â  Â  // Note: Using window.alert for simplicity since the user's previous code also used it.
Â  Â  Â  Â  window.alert('Delete failed: '+e.message); 
Â  Â  Â  }
Â  Â  }

Â  Â  
Â  Â  /* ====== Initialization ====== */
Â  Â  function attachSort(){
Â  Â  Â  document.querySelectorAll('thead th.sort').forEach(th=>{
Â  Â  Â  Â  th.addEventListener('click',()=>{
Â  Â  Â  Â  Â  const k=th.dataset.k;
Â  Â  Â  Â  Â  if(sortKey===k) {
Â  Â  Â  Â  Â  Â  sortDir = (sortDir==='asc'?'desc':'asc');
Â  Â  Â  Â  Â  } else { 
Â  Â  Â  Â  Â  Â  sortKey=k; 
Â  Â  Â  Â  Â  Â  sortDir='asc'; 
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  // Update class names for all headers
Â  Â  Â  Â  Â  document.querySelectorAll('thead th.sort').forEach(x=>{
Â  Â  Â  Â  Â  Â  x.classList.remove('asc','desc');
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  th.classList.add(sortDir);
Â  Â  Â  Â  Â  apply();
Â  Â  Â  Â  });
Â  Â  Â  });
Â  Â  }

Â  Â  async function reload(){
Â  Â  Â  document.getElementById('status').textContent = 'Loading data...';
Â  Â  Â  all = await fetchVoters();
Â  Â  Â  document.getElementById('status').textContent = `Loaded ${all.length} total voter(s).`;
Â  Â  Â  // Re-apply filter and sort to render the data
Â  Â  Â  apply();
Â  Â  }

Â  Â  // Event Listeners
Â  Â  document.getElementById('q').addEventListener('input', apply);
Â  Â  document.getElementById('addBtn').onclick=()=>openModal(false);
Â  Â  document.getElementById('m_save').onclick=onSave;
Â  Â  document.getElementById('modal').addEventListener('click',e=>{
Â  Â  Â  if(e.target===document.getElementById('modal')) closeModal();
Â  Â  });

Â  Â  // Initial setup
Â  Â  attachSort();
Â  Â  reload();

Â  </script>
</body>
</html>
