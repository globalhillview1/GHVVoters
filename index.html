<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8" />
Â  <title>Voters Management</title>
Â  <meta name="viewport" content="width=device-width, initial-scale=1" />
Â  <style>
Â  Â  /* CSS Styling - All Inline for simplicity and best performance on GitHub Pages */
Â  Â  :root{
Â  Â  Â  --bg:#f7f9fc; --card:#fff; --text:#0f172a; --muted:#64748b; --border:#e5e7eb; --hover:#f1f5f9;
Â  Â  Â  --blue:#0d6efd; --danger:#ef4444; --radius:14px;
Â  Â  }
Â  Â  *{box-sizing:border-box}
Â  Â  body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial}

Â  Â  header{position:sticky;top:0;z-index:10;display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 16px;background:var(--bg);border-bottom:1px solid var(--border)}
Â  Â  .brand{display:flex;align-items:center;gap:10px}
Â  Â  /* Removed image source for GitHub Pages, as it won't be served */
Â  Â  .brand img{height:28px;width:28px;border-radius:6px;object-fit:cover} 
Â  Â  h1{margin:0;font-weight:800;font-size:20px}
Â  Â  .wrap{padding:16px}
Â  Â  .card{background:#fff;border:1px solid var(--border);border-radius:var(--radius);padding:12px}
Â  Â  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
Â  Â  .muted{color:var(--muted)}
Â  Â  .hidden{display:none}
Â  Â  input,select,textarea{border:1px solid var(--border);border-radius:10px;padding:8px 10px;font:inherit}
Â  Â  .btn{appearance:none;border:1px solid var(--border);background:#fff;padding:8px 12px;border-radius:10px;cursor:pointer}
Â  Â  .btn:hover{background:var(--hover)}
Â  Â  .btn.primary{background:var(--blue);color:#fff;border-color:transparent}
Â  Â  .btn.danger{background:var(--danger);color:#fff;border-color:transparent}

Â  Â  .tableWrap{overflow:auto;border:1px solid var(--border);border-radius:12px;max-height:70vh;background:#fff}
Â  Â  table{width:100%;border-collapse:separate;border-spacing:0;table-layout:fixed}
Â  Â  thead th{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--border);padding:10px;text-align:left;white-space:nowrap;z-index:1}
Â  Â  tbody td{border-top:1px solid var(--border);padding:10px;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
Â  Â  th.sort{cursor:pointer;user-select:none}
Â  Â  th.sort:after{content:" â‡µ";color:#94a3b8;font-weight:400}
Â  Â  th.sort.asc:after{content:" â†‘"} th.sort.desc:after{content:" â†“"}

Â  Â  /* simple breadcrumb */
Â  Â  .breadcrumb{display:flex;flex-wrap:wrap;gap:6px;align-items:center;
Â  Â  Â  padding:8px 20px 0 20px;color:#6b7280;font:12px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial}
Â  Â  .breadcrumb a{color:inherit;text-decoration:none}
Â  Â  .breadcrumb a:hover{text-decoration:underline}
Â  Â  .breadcrumb .sep{opacity:.6}

Â  Â  /* modal */
Â  Â  .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:50;align-items:center;justify-content:center}
Â  Â  .modal .box{background:#fff;border-radius:12px;border:1px solid var(--border);padding:16px;width:min(900px,95vw)}
Â  Â  .box h3{margin:6px 0 12px}
Â  </style>
</head>
<body>
Â  <header>
Â  Â  <div class="brand">
Â  Â  Â  Â  Â  Â  <img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="logo" style="display:none">
Â  Â  Â  <h1>Voters</h1>
Â  Â  </div>
Â  Â  <div class="row">
Â  Â  Â  <button class="btn" onclick="location.href='.'">Home</button>
Â  Â  </div>
Â  </header>

Â  Â  <nav class="breadcrumb">
Â  Â  <a href=".">Home</a> <span class="sep">/</span> <span>Voters</span>
Â  </nav>

Â  <div class="wrap">
Â  Â  <div class="card">
Â  Â  Â  <div class="row" style="justify-content:space-between">
Â  Â  Â  Â  <div class="row">
Â  Â  Â  Â  Â  <input id="q" placeholder="Quick searchâ€¦" style="min-width:260px">
Â  Â  Â  Â  Â  <span id="meta" class="muted">Public view</span>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="row">
Â  Â  Â  Â  Â  <button id="addBtn" class="btn primary">+ Add Voter</button>
Â  Â  Â  Â  Â  <span id="status" class="muted"></span>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <div class="tableWrap" style="margin-top:10px">
Â  Â  Â  Â  <table id="grid">
Â  Â  Â  Â  Â  <colgroup>
Â  Â  Â  Â  Â  Â  <col style="width:90px">
Â  Â  Â  Â  Â  Â  <col style="width:90px">
Â  Â  Â  Â  Â  Â  <col style="width:110px">
Â  Â  Â  Â  Â  Â  <col style="width:240px">
Â  Â  Â  Â  Â  Â  <col style="width:240px">
Â  Â  Â  Â  Â  Â  <col style="width:130px">
Â  Â  Â  Â  Â  Â  <col style="width:130px">
Â  Â  Â  Â  Â  Â  <col style="width:180px">
Â  Â  Â  Â  Â  Â  <col style="width:130px">
Â  Â  Â  Â  Â  Â  <col style="width:160px">
Â  Â  Â  Â  Â  </colgroup>
Â  Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  <th class="sort" data-k="serial">Serial #</th>
Â  Â  Â  Â  Â  Â  Â  <th class="sort" data-k="tower">Tower No.</th>
Â  Â  Â  Â  Â  Â  Â  <th class="sort" data-k="flat">Flat No.</th>
Â  Â  Â  Â  Â  Â  Â  <th class="sort" data-k="firstOwner">First Owner Name</th>
Â  Â  Â  Â  Â  Â  Â  <th class="sort" data-k="secondOwner">Second Owner Name</th>
Â  Â  Â  Â  Â  Â  Â  <th class="sort" data-k="cardShare">Card &amp; Share #</th>
Â  Â  Â  Â  Â  Â  Â  <th class="sort" data-k="eligible">Eligible Voter</th>
Â  Â  Â  Â  Â  Â  Â  <th class="sort" data-k="discrepancy">Discrepancy</th>
Â  Â  Â  Â  Â  Â  Â  <th class="sort" data-k="votedEarlier">Voted Earlier</th>
Â  Â  Â  Â  Â  Â  Â  <th>Actions</th>
Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  <tbody id="body"></tbody>
Â  Â  Â  Â  </table>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  Â  <div id="modal" class="modal">
Â  Â  <div class="box">
Â  Â  Â  <h3 id="m_title">Add Voter</h3>
Â  Â  Â  <input id="m_serial" type="hidden">
Â  Â  Â  <div class="row" style="flex-wrap:wrap">
Â  Â  Â  Â  <label>Tower No. <input id="m_tower" style="width:120px"></label>
Â  Â  Â  Â  <label>Flat No. <input id="m_flat" style="width:140px"></label>
Â  Â  Â  Â  <label style="flex:1 1 280px">First Owner Name <input id="m_first" style="width:100%"></label>
Â  Â  Â  Â  <label style="flex:1 1 280px">Second Owner Name <input id="m_second" style="width:100%"></label>
Â  Â  Â  Â  <label>Card &amp; Share # <input id="m_cardshare" type="number" step="1" min="0" style="width:140px"></label>
Â  Â  Â  Â  <label>Eligible Voter
Â  Â  Â  Â  Â  <select id="m_eligible"><option>Yes</option><option>No</option></select>
Â  Â  Â  Â  </label>
Â  Â  Â  Â  <label style="flex:1 1 260px">Discrepancy
Â  Â  Â  Â  Â  <input id="m_discrepancy" style="width:100%" placeholder="(optional)">
Â  Â  Â  Â  </label>
Â  Â  Â  Â  <label>Voted Earlier
Â  Â  Â  Â  Â  <select id="m_voted"><option>Yes</option><option>No</option></select>
Â  Â  Â  Â  </label>
Â  Â  Â  </div>
Â  Â  Â  <div class="row" style="margin-top:10px">
Â  Â  Â  Â  <button class="btn" onclick="closeModal()">Cancel</button>
Â  Â  Â  Â  <button id="m_save" class="btn primary">Save</button>
Â  Â  Â  Â  <span id="m_status" class="muted" style="margin-left:auto"></span>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  <script>
Â  /* Â  Â  ðŸš¨ IMPORTANT: REPLACE THE PLACEHOLDER BELOW ðŸš¨
Â  Â  Â  Â  Use the exact, deployed URL of your Google Apps Script (code.gs).
Â  Â  Â  Â  Example: 'https://script.google.com/macros/s/AKfycby5tqQAlF7k3j.../exec'
Â  */
Â  const API = '/api'; // <-- UPDATE THIS LINE!
Â  
Â  const esc=s=>String(s??'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));

Â  let all=[], rows=[], sortKey='serial', sortDir='asc';

Â  // API Calls
Â  async function fetchVoters(){
Â  Â  const r=await fetch(`${API}?action=voters`,{cache:'no-store'});
Â  Â  const j=await r.json(); if(!j.ok) throw new Error(j.error||'Failed'); return j.data||[];
Â  }
Â  async function addVoter(payload){
Â  Â  const r=await fetch(`${API}?action=addvoter`,{
Â  Â  Â  method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)
Â  Â  });
Â  Â  const j=await r.json(); if(!j.ok) throw new Error(j.error||'Failed'); return j.data;
Â  }
Â  async function updateVoter(payload){
Â  Â  const r=await fetch(`${API}?action=updatevoter`,{
Â  Â  Â  method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)
Â  Â  });
Â  Â  const j=await r.json(); if(!j.ok) throw new Error(j.error||'Failed'); return j.data;
Â  }
Â  async function deleteVoter(serial){
Â  Â  const r=await fetch(`${API}?action=deletevoter`,{
Â  Â  Â  method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({serial})
Â  Â  });
Â  Â  const j=await r.json(); if(!j.ok) throw new Error(j.error||'Failed'); return j.data;
Â  }

Â  // Data Handling and Rendering
Â  function apply(){
Â  Â  const q=(document.getElementById('q').value||'').toLowerCase();
Â  Â  rows = (all||[]).filter(r=>{
Â  Â  Â  const hay = `${r.serial} ${r.tower} ${r.flat} ${r.firstOwner} ${r.secondOwner} ${r.cardShare} ${r.eligible} ${r.discrepancy||''} ${r.votedEarlier}`.toLowerCase();
Â  Â  Â  return !q || hay.includes(q);
Â  Â  }).sort((a,b)=>{
Â  Â  Â  let A=a[sortKey], B=b[sortKey];
Â  Â  Â  if(sortKey==='serial' || sortKey==='cardShare'){ A=Number(A||0); B=Number(B||0); }
Â  Â  Â  else if(sortKey==='flat'){ const na=parseInt(A,10), nb=parseInt(B,10); if(!isNaN(na)&&!isNaN(nb)){ A=na; B=nb; } }
Â  Â  Â  else { A=(A??'').toString().toLowerCase(); B=(B??'').toString().toLowerCase(); }
Â  Â  Â  const s=(A<B?-1:A>B?1:0); return sortDir==='asc'?s:-s;
Â  Â  });
Â  Â  render();
Â  }
Â  function render(){
Â  Â  const tb=document.getElementById('body'); tb.innerHTML='';
Â  Â  rows.forEach(r=>{
Â  Â  Â  const tr=document.createElement('tr');
Â  Â  Â  tr.innerHTML=`
Â  Â  Â  Â  <td>${esc(r.serial)}</td>
Â  Â  Â  Â  <td>${esc(r.tower)}</td>
Â  Â  Â  Â  <td>${esc(r.flat)}</td>
Â  Â  Â  Â  <td title="${esc(r.firstOwner)}">${esc(r.firstOwner)}</td>
Â  Â  Â  Â  <td title="${esc(r.secondOwner||'')}">${esc(r.secondOwner||'')}</td>
Â  Â  Â  Â  <td>${r.cardShare != null && r.cardShare !== '' ? esc(r.cardShare) : ''}</td>
Â  Â  Â  Â  <td>${esc(r.eligible)}</td>
Â  Â  Â  Â  <td title="${esc(r.discrepancy||'')}">${esc(r.discrepancy||'')}</td>
Â  Â  Â  Â  <td>${esc(r.votedEarlier)}</td>
Â  Â  Â  Â  <td class="td-actions">
Â  Â  Â  Â  Â  <button class="btn" onclick="openModal(true, ${r.serial})">Edit</button>
Â  Â  Â  Â  Â  <button class="btn danger" onclick="onDelete(${r.serial})">Delete</button>
Â  Â  Â  Â  </td>`;
Â  Â  Â  tb.appendChild(tr);
Â  Â  });
Â  Â  document.getElementById('status').textContent = `${rows.length} voter(s)`;
Â  }

Â  function attachSort(){
Â  Â  document.querySelectorAll('thead th.sort').forEach(th=>{
Â  Â  Â  th.addEventListener('click',()=>{
Â  Â  Â  Â  const k=th.dataset.k;
Â  Â  Â  Â  if(sortKey===k) sortDir = (sortDir==='asc'?'desc':'asc');
Â  Â  Â  Â  else { sortKey=k; sortDir='asc'; }
Â  Â  Â  Â  document.querySelectorAll('thead th.sort').forEach(x=>x.classList.remove('asc','desc'));
Â  Â  Â  Â  th.classList.add(sortDir);
Â  Â  Â  Â  apply();
Â  Â  Â  });
Â  Â  });
Â  }

Â  // Modal Handling
Â  function openModal(edit=false, serial=null){
Â  Â  document.getElementById('m_status').textContent='';
Â  Â  document.getElementById('m_title').textContent = edit?'Edit Voter':'Add Voter';
Â  Â  document.getElementById('modal').style.display='flex';
Â  Â  if(edit){
Â  Â  Â  const r=all.find(x=>x.serial==serial);
Â  Â  Â  document.getElementById('m_serial').value=r.serial;
Â  Â  Â  document.getElementById('m_tower').value=r.tower||'';
Â  Â  Â  document.getElementById('m_flat').value=r.flat||'';
Â  Â  Â  document.getElementById('m_first').value=r.firstOwner||'';
Â  Â  Â  document.getElementById('m_second').value=r.secondOwner||'';
Â  Â  Â  document.getElementById('m_cardshare').value=r.cardShare||'';
Â  Â  Â  document.getElementById('m_eligible').value=r.eligible||'Yes';
Â  Â  Â  document.getElementById('m_discrepancy').value=r.discrepancy||'';
Â  Â  Â  document.getElementById('m_voted').value=r.votedEarlier||'No';
Â  Â  }else{
Â  Â  Â  document.getElementById('m_serial').value='';
Â  Â  Â  ['m_tower','m_flat','m_first','m_second','m_cardshare','m_discrepancy'].forEach(id=>document.getElementById(id).value='');
Â  Â  Â  document.getElementById('m_eligible').value='Yes';
Â  Â  Â  document.getElementById('m_voted').value='No';
Â  Â  }
Â  }
Â  function closeModal(){ document.getElementById('modal').style.display='none'; }

Â  async function onSave(){
Â  Â  const s=document.getElementById('m_status');
Â  Â  const cardShareValue = document.getElementById('m_cardshare').value;
Â  Â  const payload={
Â  Â  Â  serial: document.getElementById('m_serial').value || undefined,
Â  Â  Â  tower: (document.getElementById('m_tower').value||'').trim(),
Â  Â  Â  flat: (document.getElementById('m_flat').value||'').trim(),
Â  Â  Â  firstOwner: (document.getElementById('m_first').value||'').trim(),
Â  Â  Â  secondOwner: (document.getElementById('m_second').value||'').trim(),
Â  Â  Â  cardShare: cardShareValue === '' ? '' : Number(cardShareValue), // Send empty string if empty, otherwise a number
Â  Â  Â  eligible: document.getElementById('m_eligible').value,
Â  Â  Â  discrepancy: (document.getElementById('m_discrepancy').value||'').trim(),
Â  Â  Â  votedEarlier: document.getElementById('m_voted').value
Â  Â  };
Â  Â  if(!payload.tower || !payload.flat || !payload.firstOwner){
Â  Â  Â  s.textContent='Tower, Flat and First Owner are required.'; return;
Â  Â  }
Â  Â  s.textContent='Savingâ€¦';
Â  Â  try{
Â  Â  Â  if(payload.serial!=null){ await updateVoter(payload); }
Â  Â  Â  else { await addVoter(payload); }
Â  Â  Â  s.textContent='Saved'; closeModal(); await reload();
Â  Â  }catch(e){ s.textContent='Save failed: '+e.message; }
Â  }
Â  async function onDelete(serial){
Â  Â  if(!confirm('Delete voter #'+serial+'?')) return;
Â  Â  try{ await deleteVoter(serial); await reload(); }
Â  Â  catch(e){ alert('Delete failed: '+e.message); }
Â  }

Â  async function reload(){
Â  Â  try {
Â  Â  Â  document.getElementById('status').textContent = 'Loading...';
Â  Â  Â  all = await fetchVoters();
Â  Â  Â  apply();
Â  Â  } catch (e) {
Â  Â  Â  document.getElementById('status').textContent = 'Error loading data: ' + e.message;
Â  Â  }
Â  }

Â  // Initialization
Â  document.getElementById('q').addEventListener('input', apply);
Â  document.getElementById('addBtn').onclick=()=>openModal(false);
Â  document.getElementById('m_save').onclick=onSave;
Â  document.getElementById('modal').addEventListener('click',e=>{
Â  Â  if(e.target===document.getElementById('modal')) closeModal();
Â  });
Â  attachSort();
Â  reload();
Â  </script>
</body>
</html>
